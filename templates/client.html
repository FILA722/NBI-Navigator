{% extends 'search_base.html' %}
@import "../node_modules/bootstrap/scss/bootstrap";

{% block title %}
{{ client_name.upper() }}
{% endblock %}

{% block body %}
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script type=text/javascript>
        $(function() {
          $('button#port_reboot').on('click', function(e) {
            e.preventDefault()
            alert( 'ПОРТ ПЕРЕДЁРНУТ' );
            $.getJSON('/port_reboot',
                function(data) {
              //do nothing
            });
            return false;
          });
        });

        $(function() {
          $('button#write_mac').on('click', function(e) {
            e.preventDefault()
            alert( 'МАК ПРОПИСАН' );
            $.getJSON('/write_mac',
                function(data) {
              //do nothing
            });
            return false;
          });
        });

        $(function() {
          $('button#client_turn_on').on('click', function(e) {
            e.preventDefault()
            $.getJSON('/client_turn_on',
                function(data) {
              //do nothing
            });
            return false;
          });
        });

</script>

<script>

    function openCity(evt, cityName) {
    // Declare all variables
    var i, tabcontent, tablinks;

    // Get all elements with class="tabcontent" and hide them
    tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
    }

    // Get all elements with class="tablinks" and remove the class "active"
    tablinks = document.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
    }

    // Show the current tab, and add an "active" class to the button that opened the tab
    document.getElementById(cityName).style.display = "block";
    evt.currentTarget.className += " active";
}
</script>

<script>
function copy(text) {
    var input = document.createElement('input');
    input.setAttribute('value', text);
    document.body.appendChild(input);
    input.select();
    var result = document.execCommand('copy');
    document.body.removeChild(input)
    alert('Это Huawei, его IP скопирован в буфер обмена.');
    return result;
 }
</script>

<br>
    <header class="d-flex flex-wrap align-items-center justify-content-center justify-content-md-between py-3 mb-4 border-bottom">
      <ul class="nav col-12 col-md-auto mb-3 justify-content-center mb-md-0">
        <a class="btn btn-outline-secondary" href="/">NBI-Navigator</a>
      </ul>
      <div class="col-8">
          <form method="post">
              <div class="input-group">
                <input type="text" name="client" class="form-control" value="{{ request.form['client'] }}" placeholder="Имя клиента" aria-label="Имя клиента" aria-describedby="button-addon2">
                <input type="submit" class="btn btn-outline-primary" value="Найти">
              </div>
            </form>
      </div>
        <a type="button" class="btn btn-warning" href="/update_db_waiter"><font color="#696969">Обновить БД</font></a>
      </div>
    </header>

<div class="container">
<table class="table table-bordered client-table border border-2 ip">
    <tbody>
        <tr>
            <th scope="row" class="align-middle center"><h5>{{ client_name.upper() }} | <a class="btn btn-outline-primary btn-sm" href="{{ client_url }}">Netsore</a></h5></th>
        </tr>
    </tbody>
</table>
<table class="table table-bordered client-table border border-2 ip">
        <tbody>
            <tr>
              <th scope="row" class="center">Телефон: </th>
              <td class="center">{{ client_tel }}</td>
            </tr>
            <tr>
              <th scope="row" class="center">E-mail: </th>
              <td class="center">{{ client_email }}</td>
            </tr>
            <tr>
                <th scope="row" class="center">Состояние: </th>
                {% if client_is_active == "Активний" %}
                    <td class="center"><font color="green"> {{ client_is_active }} </font></td>
                {% else %}
                    <td class="center"><font color="red"> {{ client_is_active }} </font><button type="button" class="btn btn-outline-success btn-sm" id="client_turn_on">Включить</button></td>
                {% endif %}
            </tr>
            <tr>
                <th scope="row" class="center">Конвертор: </th>
                <td class="center">{{ client_converter }}</td>
            </tr>
            <tr>
              <th scope="row" class="center">Менеджер: </th>
              <td class="center">{{ client_manager }}</td>
            </tr>
        </tbody>
</table>
<br>
{% for ip in client_connection_data %}
    {% if client_connection_data[ip][12] == True %}
        <button class="tab btn btn-outline-success btn-lg tablinks"  onclick="openCity(event, '{{ ip }}')">{{ ip }}</button>
    {% else %}
        <button class="tab btn btn-outline-danger btn-lg tablinks" onclick="openCity(event, '{{ ip }}')">{{ ip }}</button>
    {% endif %}
{% endfor %}
<br>
{% for ip in client_connection_data %}
  <div id="{{ ip }}" class="tabcontent">
    <table class="table table-bordered client-table border border-2 ip">
        <tbody>
            <tr>

              <th scope="row" class="align-middle center col-2">Порт:</th>

                  {% if client_connection_data[ip][6] == 'up' %}
                    <td class="align-middle center col-1"><font color="green">{{ client_connection_data[ip][6].upper() }}</font></td>
                  {% else %}
                    <td class="align-middle center col-1"><font color="red">{{ client_connection_data[ip][6].upper() }}</font></td>
                  {% endif %}

              {% if client_connection_data[ip][13] == True %}
                    {% if client_connection_data[ip][5] == "huawei" %}
                        <td class="center col-4">
                            <button class="align-middle center btn btn-outline-success btn-sm" onclick="copy('{{ client_connection_data[ip][1] }}')">
                                {{ client_connection_data[ip][0] }}{{ client_connection_data[ip][2] }}
                            </button>
                        </td>
                    {% else %}
                        <td class="center col-4">
                            <a class="align-middle center btn btn-outline-success btn-sm" href="http://{{ client_connection_data[ip][1] }}">
                                {{ client_connection_data[ip][0] }}{{ client_connection_data[ip][2] }}</a>
                        </td>
                    {% endif %}
              {% else %}
                <td class="center col-4">
                    <a class="align-middle center btn btn-outline-danger btn-sm disabled" role="button" aria-disabled="true">
                        {{ client_connection_data[ip][0] }}{{ client_connection_data[ip][2] }}</a>
<!--                    <br>-->
<!--                    (no ping to {{ client_connection_data[ip][1] }} {{ client_connection_data[ip][5] }})-->
                </td>
              {% endif %}

              {% if client_connection_data[ip][9] == '0' %}
                <td class="align-middle center col-3">Ошибки: <font color="green">{{ client_connection_data[ip][9] }}</font></td>
              {% else %}
                <td class="align-middle center col-3">Ошибки: <font color="red">{{ client_connection_data[ip][9] }}</font></td>
              {% endif %}

              <td class="align-middle center col-2">
                  <button type="button" class="btn btn-warning" id="port_reboot">Дернуть порт</button>
              </td>

            </tr>
        </tbody>
    </table>

    <table class="table table-bordered client-table border border-2 ip">
        <tbody>
            <tr>
              <th scope="row" class="align-middle center col-2">MAC на порту:</th>

              <td class="center col-4">
                  Прописан:
                  {% for mac_on in client_connection_data[ip][7] %}
                    <br>
                    <font color="green">{{ mac_on }}</font>
                  {% endfor %}
              </td>
              <td class="center col-4">
                Приходит:
                  {% for mac_in in client_connection_data[ip][8] %}
                    <br>
                    {% if mac_in[1] == 'green' %}
                      <font color="green">{{ mac_in[0] }}</font>
                    {% else %}
                      <font color="red">{{ mac_in[0] }}</font>
                    {% endif %}
                  {% endfor %}
              </td>
                  {% if client_connection_data[ip][10] == False %}
                      <td class="align-middle center col-2"><button type="submit" class="btn btn-warning form-control disabled">Прописать</button></td>
                  {% else %}
                      <form action="/write_mac" method="post">
                          <td class="align-middle center col-2"><button type="submit" class="btn btn-warning form-control" name="write_mac_address" value="{{ client_connection_data[ip][7] }}+{{ client_connection_data[ip][8] }}+{{ client_connection_data[ip][1] }}+{{ client_connection_data[ip][2] }}+{{ client_connection_data[ip][5] }}+{{ ip }}+{{ client_name }}+{{ client_connection_data[ip][11] }}">Прописать</button></td>
                      </form>
                  {% endif %}
              </td>
            </tr>
        </tbody>
    </table>
    <div class="col-10">
      <table class="table table-bordered client-table border border-2 ip">
            <tbody>
                <tr>
                  <th scope="row" class="align-middle center col-2">Настройки:</th>
                  <td class="center col-4">
                      Шлюз: {{ client_connection_data[ip][3] }}
                  </td>
                  <td class="center col-4">
                      Маска: {{ client_connection_data[ip][4] }}
                  </td>
                </tr>
            </tbody>
      </table>
    </div>
  </div>
{% endfor %}
<br>
<div class="row">
    <div class="accordion col-6" id="accordionExample">
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingOne">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
            Нотатки клиента
          </button>
        </h2>
        <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
          <div class="accordion-body">
              {% for string in client_notes %}
                  {{ string }}
                  <br>
              {% endfor %}
          </div>
        </div>
      </div>
    </div>
    <div class="accordion col-6" id="accordionExample1">
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingOne1">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne1" aria-expanded="true" aria-controls="collapseOne1">
              Нотатки бизнес-центра
          </button>
        </h2>
        <div id="collapseOne1" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#accordionExample1">
          <div class="accordion-body">
              {% for string in client_address_notes %}
                  {{ string }}
                  <br>
              {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<br>
{% endblock %}